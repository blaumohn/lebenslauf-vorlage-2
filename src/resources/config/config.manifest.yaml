variables:
  context:
    PIPELINE: {}
    PHASE: {}

  app:
    APP_BASE_PATH:
      meta:
        desc: "URL-Basis-Pfad der Anwendung (Routing)"
        notes: >-
          Nicht mit Dateisystem-Pfad verwechseln. Beispiel: /public bei
          https://domain.tld/public
        example: "/public"
    APP_URL:
      meta:
        desc: "Basis-URL der Anwendung"
        example: "https://example.invalid"
    TRUST_PROXY: {}

  lebenslauf:
    LEBENSLAUF_DATEN_PFAD: {}
    LEBENSLAUF_YAML_PFAD: {}
    LEBENSLAUF_JSON_PFAD: {}
    LEBENSLAUF_PUBLIC_PROFILE: {}
    LEBENSLAUF_LANG_DEFAULT: {}
    LEBENSLAUF_LANGS: {}

  captcha:
    CAPTCHA_TTL_SECONDS: {}
    CAPTCHA_MAX_GET: {}

  contact:
    CONTACT_MAX_POST: {}
    CONTACT_TO_EMAIL:
      meta:
        desc: "Empfaengeradresse fuer Kontaktformular"
        example: "kontakt@example.invalid"
    CONTACT_FROM_EMAIL:
      meta:
        desc: "Absenderadresse fuer Kontaktformular"
        example: "web@example.invalid"

  rate_limit:
    RATE_LIMIT_WINDOW_SECONDS: {}

  mail:
    MAIL_STDOUT:
      meta:
        notes: "SMTP_* nur notwendig, wenn MAIL_STDOUT=0."
    SMTP_HOST:
      meta:
        desc: "SMTP-Host"
        example: "smtp.example.invalid"
    SMTP_PORT: {}
    SMTP_USER:
      meta:
        desc: "SMTP-User"
        example: "user"
    SMTP_PASS:
      sources: [system, local]
    SMTP_ENCRYPTION: {}
    SMTP_FROM_EMAIL:
      meta:
        desc: "Absenderadresse fuer SMTP"
        example: "kontakt@example.invalid"
    SMTP_FROM_NAME:
      meta:
        desc: "Absendername fuer SMTP"
        example: "Beispiel"

  deploy:
    FTP_SERVER_DIR: {}
    FTP_PORT: {}
    FTP_HOST:
      sources: [system, local]
    FTP_USER:
      sources: [system, local]
    FTP_PASS:
      sources: [system, local]

  tooling:
    PYTHON_CMD: {}
    PYTHON_PATHS: {}

  tests:
    CLONE_SOURCE: {}
    KEEP_SMOKE_CLONE: {}

pipelines:
  common:
    setup:
      required: [PIPELINE, PHASE]
      allowed: [context, app, lebenslauf, tooling, tests]
    python:
      required: [PIPELINE, PHASE]
      allowed: [context, tooling]
    build:
      required: [PIPELINE, PHASE]
      allowed: [context, app, lebenslauf]
    runtime:
      required: [PIPELINE, PHASE]
      allowed: [context, app, lebenslauf, captcha, contact, rate_limit, mail]
    deploy:
      required: [PIPELINE, PHASE]
      allowed: [context, deploy]

  dev:
    setup:
      required: []
      allowed: []
    runtime:
      required:
        - CAPTCHA_MAX_GET
        - CONTACT_MAX_POST
        - RATE_LIMIT_WINDOW_SECONDS
        - MAIL_STDOUT
      allowed: []

  preview:
    build:
      required:
        - LEBENSLAUF_DATEN_PFAD
        - LEBENSLAUF_PUBLIC_PROFILE
        - LEBENSLAUF_LANG_DEFAULT
        - LEBENSLAUF_LANGS
      allowed: []
    runtime:
      required:
        - CAPTCHA_MAX_GET
        - CONTACT_MAX_POST
        - RATE_LIMIT_WINDOW_SECONDS
        - MAIL_STDOUT
        - LEBENSLAUF_PUBLIC_PROFILE
        - LEBENSLAUF_LANG_DEFAULT
        - LEBENSLAUF_LANGS
      allowed: []
    deploy:
      required:
        - FTP_SERVER_DIR
        - FTP_HOST
        - FTP_USER
        - FTP_PASS
      allowed: []
